openapi: 3.0.0
info:
  title: Shinr User Management API
  version: "1.0.0"
  description: API documentation for login and OTP verification

servers:
  - url: https://shinr-user-mgmt.onrender.com/

tags:
  - name: Auth
    description: Authentication endpoints
  - name: User Profile
    description: User profile and location endpoints
  - name: Vehicle
    description: Vehicle-related endpoints for fetching car details
  - name: Service
    description: Service management endpoints
  - name: Banner
    description: Banner management endpoints


paths:

  /user/login/otp:
    post:
      tags:
        - Auth
      summary: Generate OTP for login
      description: Sends an OTP token for a mobile number. Creates user/device if not exists.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - mobile
              properties:
                mobile:
                  type: string
      responses:
        "200":
          description: OTP generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessOtpTokenResponse'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /user/login/verify-otp:
    post:
      tags:
        - Auth
      summary: Verify OTP and generate access & refresh tokens
      description: Verifies the OTP for a user device and returns JWT tokens.
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
          description: The unique ID of the device making the request
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - otpToken
                - otp
              properties:
                otpToken:
                  type: string
                otp:
                  type: string
      responses:
        "200":
          description: OTP verified successfully and tokens generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessAuthTokensResponse'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /user/login/resend-otp:
    post:
      tags:
        - Auth
      summary: Resend OTP for a user device
      description: |
        Resends an OTP for a user device. 
        Validates the device, checks request count and cooldown (45 seconds), and generates a new OTP and token.
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - otpToken
              properties:
                otpToken:
                  type: string
      responses:
        "200":
          description: OTP resent successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessOtpTokenResponse'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "429":
          $ref: '#/components/responses/TooManyRequestsError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /user/login/generate-refreshToken:
    post:
      tags:
        - Auth
      summary: Refresh Access and Refresh Tokens
      description: >
        Refreshes the user's access and refresh tokens using a valid refresh token.
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
      responses:
        "200":
          description: Tokens refreshed successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessAuthTokensResponse'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "401":
          $ref: '#/components/responses/UnauthorizedError'
        "500":
          $ref: '#/components/responses/InternalServerError'
      security: []

  /user/logout:
    post:
      tags:
        - Auth
      summary: Logout user and invalidate tokens
      description: |
        Logs out the currently authenticated user from the specified device.
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Logged out successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessageOnly'
        "401":
          $ref: '#/components/responses/UnauthorizedError'
        "404":
          $ref: '#/components/responses/NotFoundError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /user-profile/location-autocomplete:
    get:
      tags:
        - User Profile
      summary: Get location suggestions by search query
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: search
          required: true
          schema:
            type: string
            minLength: 3
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Autocomplete results fetched successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessLocationAutocompleteResponse'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "401":
          $ref: '#/components/responses/UnauthorizedError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /user-profile/get-location/reverse-geocode:
    post:
      tags:
        - User Profile
      summary: Get address from latitude and longitude
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [lat, lng]
              properties:
                lat:
                  type: string
                lng:
                  type: string
      responses:
        "201":
          description: Address fetched successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessAddressResponse'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "401":
          $ref: '#/components/responses/UnauthorizedError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /user-profile/add-address:
    post:
      tags:
        - User Profile
      summary: Add a new address for the user
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - addressLine1
                - country
                - city
                - state
                - pinCode
                - latitude
                - longitude
              properties:
                nickName: { type: string }
                name: { type: string }
                addressLine1: { type: string }
                country: { type: string }
                city: { type: string }
                state: { type: string }
                pinCode: { type: string }
                latitude: { type: number }
                longitude: { type: number }
      responses:
        "201":
          description: Address saved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessAddressResponse'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "401":
          $ref: '#/components/responses/UnauthorizedError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /user-profile/remove-address/{id}:
    post:
      tags:
        - User Profile
      summary: Remove an address by ID
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Address removed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessageOnly'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "401":
          $ref: '#/components/responses/UnauthorizedError'
        "404":
          $ref: '#/components/responses/NotFoundError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /user-profile/select-address/{id}:
    post:
      tags:
        - User Profile
      summary: Select an address by ID
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Address selected successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessSelectedAddressResponse'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "401":
          $ref: '#/components/responses/UnauthorizedError'
        "404":
          $ref: '#/components/responses/NotFoundError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  ####################################################
  # NEW ROUTE ADDED
  ####################################################

  /user-profile/addresses:
    get:
      tags:
        - User Profile
      summary: Get list of user's saved addresses
      description: Returns all active addresses of the authenticated user.
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: User addresses fetched successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessUserAddressesResponse'
        "401":
          $ref: '#/components/responses/UnauthorizedError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  ####################################################

  /car:
    get:
      tags:
        - Vehicle
      summary: Fetch cars with filtering, sorting, and pagination
      security:
        - bearerAuth: []
      parameters:
        - name: x-device-id
          in: header
          required: true
          schema:
            type: string
        - name: search
          in: query
          schema: { type: string }
        - name: makeId
          in: query
          schema: { type: integer }
        - name: categoryId
          in: query
          schema: { type: integer }
        - name: page
          in: query
          schema: { type: integer, default: 1 }
        - name: limit
          in: query
          schema: { type: integer, default: 10 }
        - name: sortOrder
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: asc
      responses:
        "200":
          description: Cars fetched successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessCarsResponse'
        "401":
          $ref: '#/components/responses/UnauthorizedError'
        "404":
          $ref: '#/components/responses/NotFoundError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /cars/car-brands:
    get:
      tags:
        - Vehicle
      summary: Fetch car brands (makes)
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema: { type: string }
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: limit
          schema: { type: integer, default: 10 }
      responses:
        "200":
          description: Car brands fetched successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessCarBrandsResponse'
        "401":
          $ref: '#/components/responses/UnauthorizedError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /service/add-service:
    post:
      tags:
        - Service
      summary: Add a new service
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddServiceRequest"
      responses:
        "201":
          description: Service added successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessAddServiceResponse"
        "400":
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Failed to add service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
                
  /banner/add:
    post:
      tags:
        - Banner
      summary: Create a new banner
      description: Creates a banner with either text-based or image-based content.
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBannerRequest'
            examples:
              TextBannerExample:
                summary: Text Banner Example
                value:
                  text: "Super Offer!"
                  bgColour: "#FFD700"
                  buttonText: "Book Now"
                  targetValue: "SERVICE_123"
              ImageBannerExample:
                summary: Image Banner Example
                value:
                  bgImageId: "img_92734"
                  buttonText: "Book Now"
                  targetValue: "SERVICE_123"
      responses:
        "201":
          description: Banner created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessCreateBannerResponse'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "500":
          $ref: '#/components/responses/InternalServerError'
          
  /banner/update:
    put:
      tags:
        - Banner
      summary: Update an existing banner
      description: Partially updates a banner. ID is passed as a query parameter; all other fields in the body are optional.
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
  
        - in: query
          name: id
          required: true
          description: Banner ID to update
          schema:
            type: string
            example: "1"
  
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateBannerRequest'
            examples:
              UpdateTextBannerExample:
                summary: Update Text Banner Example
                value:
                  text: "Updated Offer!"
                  bgColour: "#00FFAA"
                  buttonText: "Explore"
                  targetValue: "SERVICE_999"
  
              UpdateImageBannerExample:
                summary: Update Image Banner Example
                value:
                  bgImageId: "img_55555"
                  buttonText: "Check Now"
                  targetValue: "SERVICE_888"
  
      responses:
        "200":
          description: Banner updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessBannerUpdateResponse'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "404":
          $ref: '#/components/responses/NotFoundError'
        "500":
          $ref: '#/components/responses/InternalServerError'

          
  /banner/delete:
    post:
      tags:
        - Banner
      summary: Delete a banner
      description: Deletes an existing banner using its ID passed as a query parameter.
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
  
        - in: query
          name: id
          required: true
          description: Banner ID to delete
          schema:
            type: string
            example: "1"
  
      responses:
        "200":
          description: Banner deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessBannerDeleteResponse'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "404":
          $ref: '#/components/responses/NotFoundError'
        "500":
          $ref: '#/components/responses/InternalServerError'






components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
  
    CreateBannerRequest:
      oneOf:
        - $ref: '#/components/schemas/TextBannerRequest'
        - $ref: '#/components/schemas/ImageBannerRequest'
  
    TextBannerRequest:
      
      required:
        - text
        - bgColour
        - buttonText
        - targetValue
      properties:
        type:
          type: string
          example: "text"
        text:
          type: string
          example: "Super Offer!"
        bgColour:
          type: string
          example: "#FFD700"
        buttonText:
          type: string
          example: "Book Now"
        targetValue:
          type: string
          example: "SERVICE_123"
    
    ImageBannerRequest:
      
      required:
        - bgImageId
        - buttonText
        - targetValue
      properties:
        type:
          type: string
          example: "image"
        bgImageId:
          type: string
          example: "img_92734"
        buttonText:
          type: string
          example: "Book Now"
        targetValue:
          type: string
          example: "SERVICE_123"
          
    SuccessBannerUpdateResponse:
      type: object
      properties:
        message:
          type: string
          example: "Banner updated successfully"
          
    UpdateBannerRequest:
      oneOf:
        - $ref: '#/components/schemas/UpdateTextBannerRequest'
        - $ref: '#/components/schemas/UpdateImageBannerRequest'
    UpdateTextBannerRequest:
      type: object
      required:
        - id
        - type
      properties:
        type:
          type: string
          example: "text"
        text:
          type: string
          example: "Updated Offer!"
        bgColour:
          type: string
          example: "#00FFAA"
        buttonText:
          type: string
          example: "Explore"
        targetValue:
          type: string
          example: "SERVICE_999"
    UpdateImageBannerRequest:
      type: object
      required:
        - id
        - type
      properties:
        type:
          type: string
          example: "image"
        bgImageId:
          type: string
          example: "img_55555"
        buttonText:
          type: string
          example: "Check Now"
        targetValue:
          type: string
          example: "SERVICE_888"

    SuccessBannerDeleteResponse:
      type: object
      properties:
        message:
          type: string
          example: "Banner deleted successfully"

    SuccessMessageOnly:
      type: object
      properties:
        message: { type: string, example: Operation completed successfully }

    SuccessOtpTokenResponse:
      type: object
      properties:
        message: { type: string, example: OTP resent successfully }
        data:
          type: object
          properties:
            otpToken: { type: string }

    SuccessAuthTokensResponse:
      type: object
      properties:
        message: { type: string, example: OTP verified successfully }
        data:
          type: object
          properties:
            accessToken: { type: string }
            refreshToken: { type: string }
            
    SuccessCreateBannerResponse:
      type: object
      properties:
        message:
          type: string
          example: Banner created successfully

    SuccessLocationAutocompleteResponse:
      type: object
      properties:
        message: { type: string }
        data:
          type: array
          items:
            type: object
            properties:
              addressId: { type: integer }
              name: { type: string }
              addressLine1: { type: string }
              city: { type: string }
              state: { type: string }
              country: { type: string }
              pinCode: { type: string }
              latitude: { type: number }
              longitude: { type: number }
        total: { type: integer }
        page: { type: integer }
        limit: { type: integer }

    SuccessAddressResponse:
      type: object
      properties:
        message: { type: string }
        data:
          type: object
          properties:
            addressId: { type: integer }
            nickName: { type: string }
            name: { type: string }
            addressLine1: { type: string }
            city: { type: string }
            state: { type: string }
            country: { type: string }
            pinCode: { type: string }
            latitude: { type: number }
            longitude: { type: number }

    SuccessSelectedAddressResponse:
      type: object
      properties:
        message: { type: string }
        data:
          type: object
          properties:
            selectedAddressId: { type: integer }

    SuccessCarsResponse:
      type: object
      properties:
        message: { type: string }
        data:
          type: array
          items:
            type: object
            properties:
              id: { type: integer }
              model: { type: string }
              makeId: { type: integer }
              makeName: { type: string }
              categoryId: { type: integer }
              categoryName: { type: string }
        total: { type: integer }
        page: { type: integer }
        limit: { type: integer }

    SuccessCarBrandsResponse:
      type: object
      properties:
        message: { type: string }
        data:
          type: array
          items:
            type: object
            properties:
              id: { type: integer }
              name: { type: string }
        total: { type: integer }
        page: { type: integer }
        limit: { type: integer }

    AddServiceRequest:
      type: object
      required:
        - name
        - displayName
        - imageId
        - targetValue
      properties:
        name: { type: string }
        displayName: { type: string }
        imageId: { type: string }
        targetValue: { type: string }

    SuccessAddServiceResponse:
      type: object
      properties:
        message: { type: string }
        data:
          type: object
          properties:
            id: { type: integer }
            name: { type: string }
            displayName: { type: string }
            imageId: { type: string }
            targetValue: { type: string }
            isActive: { type: boolean }

    ####################################################
    # NEW SCHEMA FOR USER ADDRESS LIST
    ####################################################

    SuccessUserAddressesResponse:
      type: object
      properties:
        message:
          type: string
          example: User addresses fetched successfully
        data:
          type: object
          properties:
            addresses:
              type: array
              items:
                type: object
                properties:
                  addressId: { type: integer }
                  nickName: { type: string }
                  name: { type: string }
                  addressLine1: { type: string }
                  country: { type: string }
                  city: { type: string }
                  state: { type: string }
                  pinCode: { type: string }
                  latitude: { type: number }
                  longitude: { type: number }
                  isDefault: { type: boolean }
                  createdAt: { type: string }
                  updatedAt: { type: string }
            total:
              type: integer
              example: 1

    ErrorResponse:
      type: object
      properties:
        message: { type: string }
        errorCode: { type: string }
        statusCode: { type: integer }

  responses:
    BadRequestError:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    UnauthorizedError:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFoundError:
      description: Resource Not Found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    TooManyRequestsError:
      description: Too many requests
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
            
            

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
