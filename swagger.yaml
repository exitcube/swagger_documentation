openapi: 3.0.0
info:
  title: Shinr User Management API
  version: "1.0.0"
  description: API documentation for login and OTP verification

servers:
  - url: https://shinr-user-mgmt.onrender.com/

tags:
  - name: Auth
    description: Authentication endpoints

paths:
  /user/login/otp:
    post:
      tags:
        - Auth
      summary: Generate OTP for login
      description: Sends an OTP token for a mobile number. Creates user/device if not exists.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - mobile
              properties:
                mobile:
                  type: string
      responses:
        "200":
          description: OTP generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      otpToken:
                        type: string
        "400":
          description: Bad Request
        "500":
          description: OTP generation failed

  /user/login/verify-otp:
    post:
      tags:
        - Auth
      summary: Verify OTP and generate access & refresh tokens
      description: Verifies the OTP for a user device and returns JWT tokens.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - otpToken
                - otp
              properties:
                otpToken:
                  type: string
                otp:
                  type: string
      responses:
        "200":
          description: OTP verified successfully and tokens generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      accessToken:
                        type: string
                      refreshToken:
                        type: string
        "400":
          description: Invalid OTP or token
        "500":
          description: OTP verification failed

  /user/login/resend-otp:
    post:
      tags:
        - Auth
      summary: Resend OTP for a user device
      description: |
        Resends an OTP for a user device. 
        Validates the device, checks request count and cooldown (45 seconds), and generates a new OTP and token.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - otpToken
              properties:
                otpToken:
                  type: string
                  description: The token from the previous OTP request
      responses:
        "200":
          description: OTP resent successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: OTP resent successfully
                  data:
                    type: object
                    properties:
                      otpToken:
                        type: string
                        description: New OTP token to be used for verification
        "400":
          description: Bad request due to invalid device or no active OTP
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: No active OTP request
                  code:
                    type: string
                    example: NO_ACTIVE_OTP
        "429":
          description: OTP request blocked due to cooldown or limit exceeded
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: OTP resend cooldown
                  code:
                    type: string
                    example: OTP_RESEND_COOLDOWN
        "500":
          description: Failed to resend OTP due to server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Failed to resend OTP. Please try again later.
                  code:
                    type: string
                    example: OTP_RESEND_FAILED

  /user/login/generate-refreshToken:
    post:
      tags:
        - Auth
      summary: Refresh Access and Refresh Tokens
      description: >
        Refreshes the user's access and refresh tokens using a valid refresh token.  
        The endpoint validates the refresh token, device identity, and user status before issuing new tokens.
      operationId: refreshTokenHandler
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
                  description: The refresh token issued during login.
      responses:
        "200":
          description: Tokens refreshed successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Tokens refreshed
                  data:
                    type: object
                    properties:
                      accessToken:
                        type: string
                        description: Newly generated access token
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                      refreshToken:
                        type: string
                        description: Newly generated refresh token
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        "400":
          description: Invalid request or token validation failed.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Failed to refresh token. Please login again.
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                        example: INVALID_DEVICE_ID
                      details:
                        type: string
                        example: The device requesting token refresh does not match the device that owns the token.
        "401":
          description: Unauthorized - Token is invalid or expired.
        "500":
          description: Internal Server Error - Token refresh failed unexpectedly.
      security: []  # No access token required; refresh token only

