openapi: 3.0.0
info:
  title: Shinr User Management API
  version: "1.0.0"
  description: API documentation for login, OTP verification, user profile & vehicle endpoints.

servers:
  - url: https://shinr-user-mgmt.onrender.com/

tags:
  - name: Auth
    description: Authentication endpoints
  - name: User Profile
    description: User profile and location endpoints
  - name: Vehicle
    description: Vehicle-related endpoints

paths:

  #######################################################################
  # AUTH ROUTES
  #######################################################################

  /user/login/otp:
    post:
      tags: [Auth]
      summary: Generate OTP for login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [mobile]
              properties:
                mobile:
                  type: string
                  example: "9876543210"
      responses:
        "200":
          description: OTP generated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OtpTokenResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /user/login/verify-otp:
    post:
      tags: [Auth]
      summary: Verify OTP and generate tokens
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [otpToken, otp]
              properties:
                otpToken:
                  type: string
                otp:
                  type: string
                  example: "123456"
      responses:
        "200":
          description: OTP verified
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokensResponse"
        "400":
          description: Invalid OTP or token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: OTP verification error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /user/login/resend-otp:
    post:
      tags: [Auth]
      summary: Resend OTP
      parameters:
        - in: header
          name: x-device-id
          schema: { type: string }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [otpToken]
              properties:
                otpToken:
                  type: string
      responses:
        "200":
          description: OTP resent
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OtpTokenResponse"
        "400":
          description: Invalid token or device
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "429":
          description: Cooldown or limit exceeded
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /user/login/generate-refreshToken:
    post:
      tags: [Auth]
      summary: Refresh tokens
      parameters:
        - in: header
          name: x-device-id
          schema: { type: string }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refreshToken]
              properties:
                refreshToken:
                  type: string
      responses:
        "200":
          description: Tokens refreshed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokensResponse"
        "400":
          description: Invalid refresh token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /user/logout:
    post:
      tags: [Auth]
      summary: Logout user
      security: [{ bearerAuth: [] }]
      parameters:
        - in: header
          name: x-device-id
          schema: { type: string }
          required: true
      responses:
        "200":
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EmptySuccessResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  #######################################################################
  # USER PROFILE ROUTES
  #######################################################################

  /user-profile/location-autocomplete:
    get:
      tags: [User Profile]
      summary: Location autocomplete
      security: [{ bearerAuth: [] }]
      parameters:
        - in: header
          name: x-device-id
          schema: { type: string }
          required: true
        - in: query
          name: search
          schema: { type: string, minLength: 3 }
          required: true
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: limit
          schema: { type: integer, default: 10 }
      responses:
        "200":
          description: Autocomplete results
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaginatedAutocompleteResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /user-profile/get-location/reverse-geocode:
    post:
      tags: [User Profile]
      summary: Reverse geocode
      security: [{ bearerAuth: [] }]
      parameters:
        - in: header
          required: true
          name: x-device-id
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [lat, lng]
              properties:
                lat: { type: string }
                lng: { type: string }
      responses:
        "201":
          description: Address fetched
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReverseGeocodeResponse"

  /user-profile/add-address:
    post:
      tags: [User Profile]
      summary: Add user address
      security: [{ bearerAuth: [] }]
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddAddressBody"
      responses:
        "201":
          description: Address saved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AddAddressResponse"

  /user-profile/remove-address/{id}:
    post:
      tags: [User Profile]
      summary: Remove address
      security: [{ bearerAuth: [] }]
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema: { type: string }
        - in: path
          name: id
          schema: { type: integer }
          required: true
      responses:
        "200":
          description: Address removed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RemoveAddressResponse"

  /user-profile/select-address/{id}:
    post:
      tags: [User Profile]
      summary: Select default address
      security: [{ bearerAuth: [] }]
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema: { type: string }
        - in: path
          name: id
          schema: { type: integer }
          required: true
      responses:
        "200":
          description: Address selected
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SelectAddressResponse"

  #######################################################################
  # VEHICLE ROUTES
  #######################################################################

  /car:
    get:
      tags: [Vehicle]
      summary: Fetch cars
      security: [{ bearerAuth: [] }]
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema: { type: string }
        - in: query
          name: search
          schema: { type: string }
        - in: query
          name: makeId
          schema: { type: integer }
        - in: query
          name: categoryId
          schema: { type: integer }
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: limit
          schema: { type: integer, default: 10 }
        - in: query
          name: sortOrder
          schema:
            type: string
            enum: [asc, desc]
            default: asc
      responses:
        "200":
          description: Cars fetched
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaginatedCarsResponse"

  /cars/car-brands:
    get:
      tags: [Vehicle]
      summary: Fetch car brands
      security: [{ bearerAuth: [] }]
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema: { type: string }
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: limit
          schema: { type: integer, default: 10 }
      responses:
        "200":
          description: Car brands fetched
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaginatedCarBrandsResponse"

#######################################################################
# COMPONENTS
#######################################################################

components:

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:

    ##########################################################
    # COMMON
    ##########################################################

    ErrorResponse:
      type: object
      properties:
        message: { type: string }
        code: { type: string }
        statusCode: { type: integer }
        publicMessage: { type: string }

    EmptySuccessResponse:
      type: object
      properties:
        message: { type: string }
        data:
          type: object
          example: {}

    ##########################################################
    # AUTH SCHEMAS
    ##########################################################

    OtpTokenResponse:
      type: object
      properties:
        message:
          type: string
          example: OTP generated
        data:
          type: object
          properties:
            otpToken:
              type: string
              example: sample.jwt.token

    TokensResponse:
      type: object
      properties:
        message:
          type: string
          example: OTP verified and tokens generated
        data:
          type: object
          properties:
            accessToken: { type: string }
            refreshToken: { type: string }

    ##########################################################
    # USER PROFILE SCHEMAS
    ##########################################################

    AutocompleteItem:
      type: object
      properties:
        name: { type: string }
        addressLine1: { type: string }
        country: { type: string }
        city: { type: string }
        state: { type: string }
        pinCode: { type: string }
        latitude: { type: number }
        longitude: { type: number }

    PaginatedAutocompleteResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/AutocompleteItem"
        total: { type: integer }
        page: { type: integer }
        limit: { type: integer }

    ReverseGeocodeResponse:
      type: object
      properties:
        message:
          type: string
        data:
          type: object
          properties:
            location:
              type: object
              properties:
                formattedAddress: { type: string }
                lat: { type: number }
                lng: { type: number }
                city: { type: string }
                state: { type: string }
                country: { type: string }
                pinCode: { type: string }

    AddAddressBody:
      type: object
      required:
        - name
        - addressLine1
        - country
        - city
        - state
        - pinCode
        - latitude
        - longitude
      properties:
        nickName: { type: string }
        name: { type: string }
        addressLine1: { type: string }
        country: { type: string }
        city: { type: string }
        state: { type: string }
        pinCode: { type: string }
        latitude: { type: number }
        longitude: { type: number }

    AddAddressResponse:
      type: object
      properties:
        message: { type: string }
        data:
          type: object
          properties:
            addressId: { type: integer }
            nickName: { type: string }
            isDefault: { type: boolean }
            address:
              $ref: "#/components/schemas/AddAddressBody"
            savedAt:
              type: string
              format: date-time

    RemoveAddressResponse:
      type: object
      properties:
        message: { type: string }
        data:
          type: object
          properties:
            updated: { type: integer }
            addressId: { type: integer }

    SelectAddressResponse:
      type: object
      properties:
        message: { type: string }
        data:
          type: object
          properties:
            selected: { type: integer }
            addressId: { type: integer }
            address:
              type: object
              properties:
                id: { type: integer }
                userId: { type: integer }
                nickName: { type: string }
                isDefault: { type: boolean }
                isActive: { type: boolean }
                name: { type: string }
                addressLine1: { type: string }
                country: { type: string }
                city: { type: string }
                state: { type: string }
                pinCode: { type: string }
                latitude: { type: number }
                longitude: { type: number }
                createdAt:
                  type: string
                  format: date-time

    ##########################################################
    # VEHICLE SCHEMAS
    ##########################################################

    CarItem:
      type: object
      properties:
        id: { type: integer }
        model: { type: string }
        makeId: { type: integer }
        makeName: { type: string }
        categoryId: { type: integer }
        categoryName: { type: string }

    PaginatedCarsResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/CarItem"
        total: { type: integer }
        page: { type: integer }
        limit: { type: integer }

    CarBrandItem:
      type: object
      properties:
        id: { type: integer }
        name: { type: string }

    PaginatedCarBrandsResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/CarBrandItem"
        total: { type: integer }
        page: { type: integer }
        limit: { type: integer }
