openapi: 3.0.0
info:
  title: Shinr User Management API
  version: "1.0.0"
  description: API documentation for login and OTP verification

servers:
  - url: https://shinr-user-mgmt.onrender.com/

tags:
  - name: Auth
    description: Authentication endpoints
  - name: User Profile
    description: User profile and location endpoints
  - name: Vehicle
    description: Vehicle-related endpoints for fetching car details
  - name: Service
    description: Service management endpoints
  - name: Banner
    description: Banner management endpoints
  - name: Admin
    description: Admin authentication and management endpoints
  - name: Profile
    description: Profile update and user-related operations


paths:

  /user/login/otp:
    post:
      tags:
        - Auth
      summary: Generate OTP for login
      description: Sends an OTP token for a mobile number. Creates user/device if not exists.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - mobile
              properties:
                mobile:
                  type: string
      responses:
        "200":
          description: OTP generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessOtpTokenResponse'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /user/login/verify-otp:
    post:
      tags:
        - Auth
      summary: Verify OTP and generate access & refresh tokens
      description: Verifies the OTP for a user device and returns JWT tokens.
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
          description: The unique ID of the device making the request
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - otpToken
                - otp
              properties:
                otpToken:
                  type: string
                otp:
                  type: string
      responses:
        "200":
          description: OTP verified successfully and tokens generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessAuthTokensResponse'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /user/login/resend-otp:
    post:
      tags:
        - Auth
      summary: Resend OTP for a user device
      description: |
        Resends an OTP for a user device. 
        Validates the device, checks request count and cooldown (45 seconds), and generates a new OTP and token.
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - otpToken
              properties:
                otpToken:
                  type: string
      responses:
        "200":
          description: OTP resent successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessOtpTokenResponse'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "429":
          $ref: '#/components/responses/TooManyRequestsError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /user/login/generate-refreshToken:
    post:
      tags:
        - Auth
      summary: Refresh Access and Refresh Tokens
      description: >
        Refreshes the user's access and refresh tokens using a valid refresh token.
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
      responses:
        "200":
          description: Tokens refreshed successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessAuthTokensResponse'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "401":
          $ref: '#/components/responses/UnauthorizedError'
        "500":
          $ref: '#/components/responses/InternalServerError'
      security: []

  /user/logout:
    post:
      tags:
        - Auth
      summary: Logout user and invalidate tokens
      description: |
        Logs out the currently authenticated user from the specified device.
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Logged out successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessageOnly'
        "401":
          $ref: '#/components/responses/UnauthorizedError'
        "404":
          $ref: '#/components/responses/NotFoundError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /user-profile/location-autocomplete:
    get:
      tags:
        - User Profile
      summary: Get location suggestions by search query
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: search
          required: true
          schema:
            type: string
            minLength: 3
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Autocomplete results fetched successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessLocationAutocompleteResponse'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "401":
          $ref: '#/components/responses/UnauthorizedError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /user-profile/get-location/reverse-geocode:
    post:
      tags:
        - User Profile
      summary: Get address from latitude and longitude
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [lat, lng]
              properties:
                lat:
                  type: string
                lng:
                  type: string
      responses:
        "201":
          description: Address fetched successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessAddressResponse'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "401":
          $ref: '#/components/responses/UnauthorizedError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /user-profile/add-address:
    post:
      tags:
        - User Profile
      summary: Add a new address for the user
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - addressLine1
                - country
                - city
                - state
                - pinCode
                - latitude
                - longitude
              properties:
                nickName: { type: string }
                name: { type: string }
                addressLine1: { type: string }
                country: { type: string }
                city: { type: string }
                state: { type: string }
                pinCode: { type: string }
                latitude: { type: number }
                longitude: { type: number }
      responses:
        "201":
          description: Address saved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessAddressResponse'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "401":
          $ref: '#/components/responses/UnauthorizedError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /user-profile/remove-address/{id}:
    post:
      tags:
        - User Profile
      summary: Remove an address by ID
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Address removed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessageOnly'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "401":
          $ref: '#/components/responses/UnauthorizedError'
        "404":
          $ref: '#/components/responses/NotFoundError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /user-profile/select-address/{id}:
    post:
      tags:
        - User Profile
      summary: Select an address by ID
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Address selected successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessSelectedAddressResponse'
        "400":
          $ref: '#/components/responses/BadRequestError'
        "401":
          $ref: '#/components/responses/UnauthorizedError'
        "404":
          $ref: '#/components/responses/NotFoundError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  ####################################################
  # NEW ROUTE ADDED
  ####################################################

  /user-profile/addresses:
    get:
      tags:
        - User Profile
      summary: Get list of user's saved addresses
      description: Returns all active addresses of the authenticated user.
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: User addresses fetched successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessUserAddressesResponse'
        "401":
          $ref: '#/components/responses/UnauthorizedError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  ####################################################

  /car:
    get:
      tags:
        - Vehicle
      summary: Fetch cars with filtering, sorting, and pagination
      security:
        - bearerAuth: []
      parameters:
        - name: x-device-id
          in: header
          required: true
          schema:
            type: string
        - name: search
          in: query
          schema: { type: string }
        - name: makeId
          in: query
          schema: { type: integer }
        - name: categoryId
          in: query
          schema: { type: integer }
        - name: page
          in: query
          schema: { type: integer, default: 1 }
        - name: limit
          in: query
          schema: { type: integer, default: 10 }
        - name: sortOrder
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: asc
      responses:
        "200":
          description: Cars fetched successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessCarsResponse'
        "401":
          $ref: '#/components/responses/UnauthorizedError'
        "404":
          $ref: '#/components/responses/NotFoundError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /cars/car-brands:
    get:
      tags:
        - Vehicle
      summary: Fetch car brands (makes)
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema: { type: string }
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: limit
          schema: { type: integer, default: 10 }
      responses:
        "200":
          description: Car brands fetched successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessCarBrandsResponse'
        "401":
          $ref: '#/components/responses/UnauthorizedError'
        "500":
          $ref: '#/components/responses/InternalServerError'

  /service/add-service:
    post:
      tags:
        - Service
      summary: Add a new service
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddServiceRequest"
      responses:
        "201":
          description: Service added successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessAddServiceResponse"
        "400":
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Failed to add service
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
          
  /admin/login:
    post:
      tags:
        - Admin
      summary: Admin Login
      description: Authenticates an admin user and returns access & refresh tokens.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userName
                - password
              properties:
                userName:
                  type: string
                  example: "shayizz400"
                password:
                  type: string
                  example: "shayiz123"
  
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Login successful
                  data:
                    type: object
                    properties:
                      accessToken:
                        type: string
                      refreshToken:
                        type: string
  
        "400":
          $ref: '#/components/responses/BadRequestError'
  
        "401":
          $ref: '#/components/responses/UnauthorizedError'
  
        "500":
          $ref: '#/components/responses/InternalServerError'

  /service/update-service/{id}:
    post:
      tags:
        - Service
      summary: Update a service
      description: Updates an existing service. Partial update supported.
      security:
        - bearerAuth: []
  
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
  
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: Service ID
  
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                displayName:
                  type: string
                imageId:
                  type: string
                targetValue:
                  type: string
  
      responses:
        "200":
          description: Service updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Service Updated successfully
                  data:
                    type: object
                    properties:
                      updated:
                        type: integer
                        example: 1
                      serviceId:
                        type: integer
                        example: 14
  
        "400":
          $ref: '#/components/responses/BadRequestError'
  
        "404":
          $ref: '#/components/responses/NotFoundError'
  
        "500":
          $ref: '#/components/responses/InternalServerError'

  /user-profile/update-profile:
    post:
      tags:
        - Profile
      summary: Update user profile details
      description: |
        Updates the authenticated user's profile information including name, email, and profile picture.
        Accepts multipart/form-data for uploading a profile picture.
        The profile picture must be in PNG, JPG, or JPEG format and less than 2MB in size.
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: x-device-id
          required: true
          schema:
            type: string
          description: Unique ID of the user's device
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: "Adarsh Vinod"
                email:
                  type: string
                  example: "adarsh@gmail.com"
                profilePic:
                  type: string
                  format: binary
                  description: "Profile picture file (PNG/JPG/JPEG). Max size: 2MB"
      responses:
        "200":
          description: Profile updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessUpdateProfileResponse"
        "400":
          $ref: "#/components/responses/BadRequestError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "500":
          $ref: "#/components/responses/InternalServerError"







components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:

    SuccessUpdateProfileResponse:
      type: object
      properties:

        data:
          type: object
          properties:
            updated:
              type: integer
              example: 1
            userId:
              type: integer
              example: 12
        message:
          type: string
          example: Profile updated successfully
  
    SuccessMessageOnly:
      type: object
      properties:
        message: { type: string, example: Operation completed successfully }

    SuccessOtpTokenResponse:
      type: object
      properties:
        message: { type: string, example: OTP resent successfully }
        data:
          type: object
          properties:
            otpToken: { type: string }

    SuccessAuthTokensResponse:
      type: object
      properties:
        message: { type: string, example: OTP verified successfully }
        data:
          type: object
          properties:
            accessToken: { type: string }
            refreshToken: { type: string }
            
    SuccessCreateBannerResponse:
      type: object
      properties:
        message:
          type: string
          example: Banner created successfully

    SuccessLocationAutocompleteResponse:
      type: object
      properties:
        message: { type: string }
        data:
          type: array
          items:
            type: object
            properties:
              addressId: { type: integer }
              name: { type: string }
              addressLine1: { type: string }
              city: { type: string }
              state: { type: string }
              country: { type: string }
              pinCode: { type: string }
              latitude: { type: number }
              longitude: { type: number }
        total: { type: integer }
        page: { type: integer }
        limit: { type: integer }

    SuccessAddressResponse:
      type: object
      properties:
        message: { type: string }
        data:
          type: object
          properties:
            addressId: { type: integer }
            nickName: { type: string }
            name: { type: string }
            addressLine1: { type: string }
            city: { type: string }
            state: { type: string }
            country: { type: string }
            pinCode: { type: string }
            latitude: { type: number }
            longitude: { type: number }

    SuccessSelectedAddressResponse:
      type: object
      properties:
        message: { type: string }
        data:
          type: object
          properties:
            selectedAddressId: { type: integer }

    SuccessCarsResponse:
      type: object
      properties:
        message: { type: string }
        data:
          type: array
          items:
            type: object
            properties:
              id: { type: integer }
              model: { type: string }
              makeId: { type: integer }
              makeName: { type: string }
              categoryId: { type: integer }
              categoryName: { type: string }
        total: { type: integer }
        page: { type: integer }
        limit: { type: integer }

    SuccessCarBrandsResponse:
      type: object
      properties:
        message: { type: string }
        data:
          type: array
          items:
            type: object
            properties:
              id: { type: integer }
              name: { type: string }
        total: { type: integer }
        page: { type: integer }
        limit: { type: integer }

    AddServiceRequest:
      type: object
      required:
        - name
        - displayName
        - imageId
        - targetValue
      properties:
        name: { type: string }
        displayName: { type: string }
        imageId: { type: string }
        targetValue: { type: string }

    SuccessAddServiceResponse:
      type: object
      properties:
        message: { type: string }
        data:
          type: object
          properties:
            id: { type: integer }
            name: { type: string }
            displayName: { type: string }
            imageId: { type: string }
            targetValue: { type: string }
            isActive: { type: boolean }

    ####################################################
    # NEW SCHEMA FOR USER ADDRESS LIST
    ####################################################

    SuccessUserAddressesResponse:
      type: object
      properties:
        message:
          type: string
          example: User addresses fetched successfully
        data:
          type: object
          properties:
            addresses:
              type: array
              items:
                type: object
                properties:
                  addressId: { type: integer }
                  nickName: { type: string }
                  name: { type: string }
                  addressLine1: { type: string }
                  country: { type: string }
                  city: { type: string }
                  state: { type: string }
                  pinCode: { type: string }
                  latitude: { type: number }
                  longitude: { type: number }
                  isDefault: { type: boolean }
                  createdAt: { type: string }
                  updatedAt: { type: string }
            total:
              type: integer
              example: 1

    ErrorResponse:
      type: object
      properties:
        message: { type: string }
        errorCode: { type: string }
        statusCode: { type: integer }

  responses:
    BadRequestError:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    UnauthorizedError:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFoundError:
      description: Resource Not Found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    TooManyRequestsError:
      description: Too many requests
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
            
            

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
